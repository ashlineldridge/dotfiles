#!/usr/bin/env bash

function usage() {
	echo "Usage: $(basename ${0}) blob-key [blob-bucket] [quarantine-bucket]"
	exit 1
}

[ $# -lt 1 ] && usage

blob_key=$1
blob_bucket=${2:-seek-blob-prod}
quarantine_bucket=${3:-seek-blob-quarantine-prod}

IFS=/
read -ra key_parts <<< "$blob_key"
key_parts_len=${#key_parts[@]}
blob_guid=${key_parts[$key_parts_len - 1]}
blob_guid_upper=$(echo $blob_guid | tr /a-z/ /A-Z/)
blob_guid_lower=$(echo $blob_guid | tr /A-Z/ /a-z/)
blob_key_upper=

function build_blob_key() {
	local key=$1
	for ((i = $key_parts_len - 2; i >= 0; i--))
	do
		key="${key_parts[$i]}|${key}"
	done
	echo $key | sed 's/|/\//g' >> /tmp/foo.log
	echo $key | sed 's/|/\//g'
}

blob_key_upper=$(build_blob_key $blob_guid_upper)
blob_key_lower=$(build_blob_key $blob_guid_lower)

echo $blob_key_upper >> /tmp/bar.log
echo $blob_key_lower >> /tmp/bar.log

